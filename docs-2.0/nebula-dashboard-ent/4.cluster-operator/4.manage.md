# 集群操作

本文主要介绍 Dashboard 企业版的集群操作，包括节点管理、扩缩容、服务管理、更新配置、成员管理和版本升级。

## 节点管理

节点管理页面展示所有的节点详情信息，包括节点名称、Host 及 SSH 用户名称、CPU 核等信息，并且支持添加节点、查看节点监控、管理节点服务等操作。

### 添加节点

单击**添加节点**，输入待添加节点的 Host 信息、SSH 端口号、SSH 用户、认证方式、安装包等，单击**确认**。

关于认证方式的说明如下：

- SSH 密码：输入 SSH 用户对应的密码。

- SSH 密钥：单击**上传**，选择节点的私钥文件。需要提前在待添加节点上生成密钥文件，并将私钥发送给当前电脑（非 Dashboard 机器）。如果设置了短密码（passphrase），也需要填写。

### 节点其他操作

在节点列表中，单击 ![plus](https://docs-cdn.nebula-graph.com.cn/figures/Plus_cn.png) 按钮，查看对应节点的服务名、服务类型、服务状态、运行路径等信息。

- 单击**节点监控**可快速跳转至节点监控页面，详情信息见[集群监控](../4.cluster-operator/2.monitor.md)。

- 单击**服务管理**可快速跳转至服务管理页面。

- 单击**编辑节点**可修改节点设置。

- 当节点上无服务时，可以**删除节点**。删除服务请参见下文**扩缩容**部分。

{{ ent.ent_begin }}
## 扩缩容

!!! enterpriseonly 

    只有创建或导入企业版 NebulaGraph 集群时，用户才会在左侧导航栏中看到扩缩容功能。

- 在扩缩容页面，用户可以快速**添加节点**、**批量导入节点**，并对已存在的节点添加 **Graph 服务**及 **Storage 服务**。
- 单击**重置**按钮，可以恢复到初始状态。

!!! caution

    - 目前仅支持对 graphd 和 storaged 进行扩缩容，不支持移除或添加 metad 服务。扩缩容集群时，建议提前备份数据，以便故障发生时回滚数据。关于扩缩容，详情参见[如何扩缩容](../../20.appendix/0.FAQ.md#_11)。

    - 集群中每种类型的服务至少要有一个，且单个节点上仅能部署一个同类型服务。

在该示例中，新增了节点为`192.168.8.143`和`192.168.8.167`的 Storage 服务，删除了节点为`192.168.8.169`的 Graph 服务。虚线框并置灰服务名表示移除的服务，实线框表示添加的服务。

在下方的**服务**中，绿色表示即将新增的服务，红色表示即将移除的服务。可以修改新增服务的端口号和 HTTP 端口号信息。

![扩缩容](https://docs-cdn.nebula-graph.com.cn/figures/scaling-ds-2022_4-14_cn.png)

{{ ent.ent_end }}

## 服务管理

- 在服务管理页面，用户可以选择服务类型、服务状态、Host 对展示的数据进行筛选，快速选中一个或多个服务，一键启动/停止/重启服务。

- 单击 ![nav](https://docs-cdn.nebula-graph.com.cn/figures/nav-dashboard_cn.png) 图标，可快速查看[服务监控](../4.cluster-operator/2.monitor.md)。

!!! danger

    单击**停止**/**重启**，会立即中断进行中的任务，可能会导致数据不一致，请在业务低峰期执行该操作。
## 更新配置

更新配置页面可以修改 Storage 及 Graph 服务的配置文件，具体参数及说明见 [Storage 服务配置](../../5.configurations-and-logs/1.configurations/4.storage-config.md)和 [Graph 服务配置](../../5.configurations-and-logs/1.configurations/3.graph-config.md)。更新配置文件为批量操作，将会修改每一个 Storage/Graph 的配置文件。

- 单击保存后，在下一次服务重启后配置即生效。

- 单击**保存并重启**可直接重启服务使配置立即生效。

  !!! danger

        单击**保存并重启**，会立即中断进行中的任务重启集群，可能会导致数据不一致，请在业务低峰期执行该操作。

## 成员管理

所有角色为`admin`的账户和角色为`user`的集群创建者可以为集群添加管理员。默认集群创建者为集群的`owner`角色，并显示在**成员管理**页面。添加的集群管理员为集群的`operator`角色。

关于账户的角色详情，参见[权限管理](../5.account-management.md)。

### 添加集群管理员

集群管理员必需是用户创建的 Dashboard 企业版账户。关于如何创建账户，参见[权限管理](../5.account-management.md)。

添加集群管理员步骤如下：

1. 在 Dashboard 企业版顶部导航栏，单击**集群管理**。
2. 在目标集群右侧，单击**详情**。
3. 在左侧导航栏，单击**集群操作**->**成员管理**。
4. 在**成员管理**页面，单击左上方的搜索框。
5. 在下拉列表中，选择需要添加的账户，然后单击右侧的**添加**。

### 其他操作

- 在**成员管理**页面右上方的搜索框中，搜索集群管理员。
- 单击![delete](https://docs-cdn.nebula-graph.com.cn/figures/alert_delete_cn.png)删除集群管理员。

## 版本升级

Dashboard 企业版支持升级现有 NebulaGraph 集群的版本。

!!! caution

    - 升级过程中会替换二进制文件，升级速度较快，但是仍会停机重启集群。
    - 不支持自动回滚，升级失败时需要手动重新升级。
    - 升级不支持暂停、取消。

!!! note

    - 仅支持升级版本不低于 **3.0.0** 的 NebulaGraph 集群。
    - 不支持跨大版本升级集群。
    - 支持社区版升级为企业版（需要上传校验 License）或企业版升级为社区版。
    - 支持升级为当前大版本内的任意小版本（包括比当前版本低的小版本）。


1. 在 Dashboard 企业版顶部导航栏，单击**集群管理**。
2. 在目标集群右侧，单击**详情**。
3. 在左侧导航栏，单击**集群操作**->**版本升级**。
4. 在**版本升级**页面确认**当前NebulaGraph版本**，选择**待升级目标版本**，单击**下一步**。

  !!! note
  
        如果没有找到合适的版本，单击**包管理中心**，下载或上传所需的版本安装包。详情参见[安装包管理](../11.manage-package.md)。

5. 进行升级检查，然后单击**下一步**。
   集群在升级期间将会停机，升级完成后会自动重启服务。升级前您可以通过**查看诊断报告**了解集群线上运行情况，从而帮助您判断当前集群停机升级是否合适。

6. 再次确认升级信息，包括**集群名称**、**当前NebulaGraph版本**和**待升级NebulaGraph版本**，然后单击**升级**。
   用户可以在在[任务中心](../10.tasks.md)查看升级任务信息，类型为`version update`。